# v5.0.5 - WeWork Compact Notification Extension

**Release Date**: 2026-01-16

## Overview

Introduces a new `wework_compact` extension that transforms verbose notification messages into a compact format optimized for WeWork and other channels with strict size limits.

## New Features

### WeWork Compact Extension

- **AI-Powered Summary**: Generates a holistic summary across all news items using the existing AI_ANALYSIS configuration
- **Compact Format**: Combines multiple news items into a single compact message:
  ```
  今日热点总结: {AI生成的跨新闻综合摘要}

  来源: 标题A (微博/抖音) / 标题B (知乎) / 标题C (百度)...

  [AI 深度分析]
  (existing AI analysis content)
  ```

- **Fallback Mode**: When AI is unavailable, uses simplified title listing:
  ```
  今日热点: 标题A (微博/抖音) / 标题B (知乎) / 标题C (百度)...
  ```

- **Platform Normalization**: Automatically converts platform IDs to readable Chinese names (weibo→微博, douyin→抖音, etc.)

### NotificationEnhancer Integration

- Added `_apply_notification_enhancement()` helper function to senders module
- Integrated enhancement pipeline into WeWork notification flow
- Added `split_content_by_bytes()` for intelligent content re-batching

### Configuration Options

New configuration file `config/extensions/wework_compact.yaml`:

```yaml
enabled: true
target_channels:
  - wework

compact_summary:
  summary_prefix: "今日热点总结:"
  source_prefix: "来源:"
  fallback_prefix: "今日热点:"
  separator: " / "
  max_titles: 20
  include_ai_analysis: true

ai:
  use_main_config: true              # Reuses AI_ANALYSIS from main config
  prompt_file: "wework_compact_prompt.txt"

fallback:
  max_title_length: 25
  max_platform_display: 3
```

## Files Changed

| File | Changes |
|------|---------|
| `extensions/wework_compact/__init__.py` | New extension (~485 lines) |
| `config/extensions/wework_compact.yaml` | Extension configuration |
| `config/wework_compact_prompt.txt` | AI prompt for summary generation |
| `pyproject.toml` | Added entry point registration |
| `trendradar/notification/senders.py` | Added enhancement integration |
| `trendradar/notification/batch.py` | Added `split_content_by_bytes()` |
| `trendradar/notification/dispatcher.py` | Pass main_config to wework sender |

## Extension Architecture

The extension implements the `NotificationEnhancer` interface:

- `enhance()` - Main entry point, replaces content with compact format
- `_extract_titles_with_platforms()` - Extracts structured data from report_data
- `_generate_cross_news_summary()` - AI-powered summary using main AI config
- `_fallback_format()` - Fallback when AI unavailable
- `_get_existing_ai_analysis()` - Appends existing AI analysis section

## Backward Compatibility

- Extension is disabled by default in configuration
- Only affects channels listed in `target_channels` (default: wework only)
- Non-targeted channels continue to work unchanged
- No modifications to existing senders or notification pipeline
