# v5.0.6 - Extension Fixes

**Release Date**: 2026-01-16

## Overview

Fixes two extension behaviors: notification_scheduler push_window bypass logic and wework_compact output format.

## Fixes

### notification_scheduler Extension

- Fixed push_window bypass to only activate when scheduler returns a non-empty channel list
- Previously bypassed push_window even when no active schedule was matched (empty list)
- Now correctly skips time range and once_per_day checks only during active schedules
- Push recording still works for analytics when scheduler is active

**Changes in `trendradar/__main__.py`**:
- Line 636: Changed bypass condition from `enabled_channels is not None` to `enabled_channels is not None and len(enabled_channels) > 0`
- Lines 657-662: Added descriptive logging for both matched and unmatched scheduler states

### wework_compact Extension

- Rewrote output format for better readability
- Changed from single-line format to summary + bullet-pointed list
- First line now shows AI-generated or fallback summary
- Each new title appears on its own line with "- " prefix
- AI analysis section preserved at end
- Now filters to show only **new titles** instead of all matched titles

**Output Format Changes**:

Before:
```
今日热点: titleA (platform) / titleB (platform) / titleC (platform)...

✨ AI 热点分析
[AI analysis content...]
```

After (AI mode):
```
今日热点: {AI-generated summary of all news}

- titleA (platform)
- titleB (platform)
- titleC (platform)
- ...

✨ AI 热点分析
[AI analysis content...]
```

After (Fallback mode):
```
今日热点: 共发现 N 条新热点

- titleA (platform)
- titleB (platform)
- ...

✨ AI 热点分析
[AI analysis content...]
```

**Changes in `extensions/wework_compact/__init__.py`**:
- `_extract_titles_with_platforms()`: Added `only_new` parameter to filter only new titles
- `enhance()`: Changed to extract only new titles (`only_new=True`)
- `_generate_ai_mode_content()`: Rewrote to output summary + bullet list format
- `_fallback_format()`: Rewrote to output "共发现 N 条新热点" + bullet list format

## Files Changed

| File | Changes |
|------|---------|
| `trendradar/__main__.py` | Fixed notification_scheduler bypass condition and logging |
| `extensions/wework_compact/__init__.py` | Rewrote output format and new title filtering |
| `pyproject.toml` | Bumped version to 5.0.6 |
| `docs/changelog/5.0.6.md` | This changelog |

## Backward Compatibility

- notification_scheduler: Existing behavior preserved when scheduler is disabled or returns None
- wework_compact: Format change is significant but data sources remain the same
- No breaking changes to APIs or configuration

## Configuration

No new configuration options. Existing `wework_compact` configuration continues to work:
- `enabled: true`
- `target_channels: [wework]`
- `compact_summary.max_titles: 20` (limits bullet list length)
- `compact_summary.include_ai_analysis: true` (preserves AI analysis section)
