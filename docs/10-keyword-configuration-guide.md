# TrendRadar 关键词配置完整指南

## 📋 目录

1. [配置文件位置](#配置文件位置)
2. [快速上手案例](#快速上手案例)
3. [语法详解](#语法详解)
4. [实战案例](#实战案例)
5. [配置操作步骤](#配置操作步骤)
6. [配置验证](#配置验证)
7. [最佳实践](#最佳实践)
8. [常见问题](#常见问题)
9. [完整配置模板](#完整配置模板)

---

## 配置文件位置

**文件路径**：`config/frequency_words.txt`

**配置结构**：
```ini
# 全局过滤区：不想看的内容
[GLOBAL_FILTER]
过滤词1
过滤词2

# 词组定义区：想关注的关键词
[WORD_GROUPS]

[词组名称]
关键词1
关键词2
```

---

## 快速上手案例

### 案例 1：关注华为相关新闻（最简单）

**需求**：关注华为、鸿蒙、任正非相关的所有新闻

**配置**：
```ini
[WORD_GROUPS]

[华为动态]
华为
鸿蒙
任正非
```

**效果**：
- ✅ "华为发布新手机" → 匹配
- ✅ "鸿蒙系统升级" → 匹配
- ✅ "任正非发表讲话" → 匹配
- 显示为：「华为动态」

---

### 案例 2：关注 AI 技术新闻（进阶）

**需求**：关注人工智能相关，但排除水果相关（避免误匹配"苹果AI"）

**配置**：
```ini
[WORD_GROUPS]

[AI前沿]
/AI|人工智能/i
!水果
!果园
```

**效果**：
- ✅ "AI技术突破" → 匹配
- ✅ "人工智能应用" → 匹配
- ❌ "苹果丰收" → 排除（包含"水果"）
- 显示为：「AI前沿」

---

### 案例 3：关注科技巨头（多个词组）

**需求**：分别关注苹果、谷歌、微软的新闻

**配置**：
```ini
[WORD_GROUPS]

[苹果公司]
苹果
iPhone
iPad
Mac

[谷歌动态]
Google
谷歌
安卓
Android

[微软新闻]
微软
Microsoft
Windows
```

**效果**：
- "苹果发布iPhone 16" → 匹配「苹果公司」
- "Google推出新功能" → 匹配「谷歌动态」
- "Windows更新" → 匹配「微软新闻」

---

## 语法详解

### 1. 普通关键词

**语法**：直接写关键词

```ini
[新闻关键词]
华为
比亚迪
小米
```

**匹配规则**：
- 标题包含"华为" → ✅ 匹配
- 标题包含"小米汽车" → ✅ 匹配

---

### 2. 正则表达式（高级匹配）

**语法**：`/正则表达式/修饰符 => 显示名称`

```ini
[科技]
/AI|人工智能|机器学习/i => AI技术
```

**说明**：
- `/.../` 表示正则表达式
- `|` 表示"或"
- `i` 表示忽略大小写
- `=>` 后面是显示名称

**示例**：

| 配置 | 效果 |
|------|------|
| `/华为|鸿蒙/i => 华为` | 匹配"华为"或"鸿蒙"，显示"华为" |
| `/\bAI\b/i => AI` | 精确匹配"AI"（不匹配"MAIL"中的"AI"） |
| `/\d{4}年/ => 年度新闻` | 匹配"2024年"、"2025年"等 |

**💡 正则表达式生成器**：问 AI
```
"帮我写一个正则表达式，匹配包含'特斯拉'或'Tesla'或'马斯克'的文本，
忽略大小写，格式要求：/正则/i => 显示名称"
```

---

### 3. 过滤特定内容（排除法）

**语法**：`!关键词`

```ini
[苹果产品]
苹果
!水果
!果园
!水果店
```

**效果**：
- ✅ "苹果发布新iPhone" → 匹配
- ❌ "苹果价格下跌"（属于水果新闻）→ 排除
- ❌ "果园采摘" → 排除

---

### 4. 限制显示条数

**语法**：`@数字`

```ini
[热门新闻]
科技
互联网
@5
```

**效果**：该词组最多显示 5 条新闻

---

### 5. 必须同时包含多个词（AND 关系）

**语法**：`+关键词`

```ini
[苹果发布会]
+苹果
+发布会
+新品
```

**效果**：必须同时包含"苹果"、"发布会"、"新品"才匹配

- ✅ "苹果举办秋季发布会发布新品" → 匹配
- ❌ "苹果股价下跌" → 不匹配（缺少"发布会"）
- ❌ "某公司发布新品" → 不匹配（缺少"苹果"）

---

### 6. 组别名（推荐）

**语法**：`[组别名]` 作为词组第一行

```ini
[华为生态]
华为
鸿蒙
任正非
```

**对比**：

| 配置 | 显示效果 |
|------|---------|
| 无组别名<br>华为<br>鸿蒙 | 华为 / 鸿蒙 |
| `[华为生态]`<br>华为<br>鸿蒙 | 华为生态（更简洁） |

---

## 实战案例

### 案例 4：关注新能源汽车

**需求**：关注特斯拉、比亚迪、蔚来、理想、小鹏的新闻

**配置**：
```ini
[WORD_GROUPS]

[新能源汽车]
/特斯拉|Tesla/i => 特斯拉
/比亚迪|BYD/i => 比亚迪
蔚来
理想汽车
小鹏汽车
```

**或者分别建组**：
```ini
[WORD_GROUPS]

[特斯拉]
/特斯拉|Tesla/i

[比亚迪]
/比亚迪|BYD/i

[新势力造车]
蔚来
理想
小鹏
```

---

### 案例 5：关注投资理财（包含过滤）

**需求**：关注股票、基金、投资，但排除广告和诈骗信息

**配置**：
```ini
[WORD_GROUPS]

[投资理财]
股票
基金
投资
理财
!广告
!推广
!骗局
!诈骗
```

**效果**：
- ✅ "A股市场分析" → 匹配
- ✅ "基金定投策略" → 匹配
- ❌ "投资理财广告" → 排除（包含"广告"）
- ❌ "最新骗局揭秘" → 排除（包含"骗局"）

---

### 案例 6：关注特定地区新闻

**需求**：关注北京、上海、深圳的新闻

**配置**：
```ini
[WORD_GROUPS]

[一线城市]
/北京|上海|深圳|广州/
```

---

### 案例 7：关注国际时事

**需求**：关注美国、欧洲、日韩的新闻

**配置**：
```ini
[WORD_GROUPS]

[美国]
/美国|USA|美国|特朗普|拜登/i

[欧洲]
/英国|法国|德国|欧洲/i

[日韩]
/日本|韩国|东京|首尔/i
```

---

### 案例 8：关注体育赛事

**需求**：关注NBA、足球、奥运会

**配置**：
```ini
[WORD_GROUPS]

[NBA]
/NBA|篮球|CBA/i

[足球]
/足球|英超|西甲|欧冠/i

[奥运会]
奥运
冬奥会
亚运会
```

---

### 案例 9：关注娱乐八卦（控制数量）

**需求**：关注明星动态，但每个词组最多显示 3 条

**配置**：
```ini
[WORD_GROUPS]

[娱乐圈]
明星
@3

[电影]
电影
票房
@3

[电视剧]
电视剧
剧集
@3
```

---

### 案例 10：复合条件（高级）

**需求**：
1. 关注华为手机新闻（排除其他产品）
2. 关注苹果iPhone发布会
3. 关注AI芯片（但排除显卡广告）

**配置**：
```ini
[WORD_GROUPS]

[华为手机]
+华为
+手机
!平板
!手表

[苹果发布会]
+苹果
+iPhone
+发布会

[AI芯片]
/AI|人工智能/i
+芯片
!显卡
!广告
```

---

## 配置操作步骤

### 方法 1：Windows 本地编辑

1. **打开配置文件**
   ```bash
   # 使用记事本打开
   notepad h:\zskj\AI\TrendRadar\TrendRadar\config\frequency_words.txt

   # 或使用 VS Code
   code h:\zskj\AI\TrendRadar\TrendRadar\config\frequency_words.txt

   # 或使用任意文本编辑器
   ```

2. **编辑内容**

   在 `[WORD_GROUPS]` 下面添加您的关键词，例如：
   ```ini
   [WORD_GROUPS]

   [华为动态]
   华为
   鸿蒙
   任正非

   [AI前沿]
   /AI|人工智能/i
   !广告
   ```

   **注意事项**：
   - 每个词组用空行分隔
   - 词组名称用 `[ ]` 包裹
   - `!` 开头表示过滤
   - `/ /` 包裹的是正则表达式

3. **保存文件**
   - 记事本：Ctrl+S
   - VS Code：Ctrl+S
   - 其他编辑器：保存或 Ctrl+S

4. **重启容器使配置生效**

   在服务器上执行：
   ```bash
   cd /soft/TrendRadar/docker
   docker compose restart
   ```

   或者在 Windows 上（如果使用 Docker Desktop）：
   ```bash
   cd h:\zskj\AI\TrendRadar\TrendRadar\docker
   docker compose restart
   ```

5. **测试配置**

   手动执行一次，查看是否匹配到关键词：
   ```bash
   docker exec -it trendradar python manage.py run
   ```

---

### 方法 2：服务器上直接编辑

如果项目部署在远程服务器：

```bash
# 1. SSH 连接到服务器
ssh user@server_ip

# 2. 进入配置目录
cd /soft/TrendRadar/config

# 3. 编辑文件（使用 vi）
vi frequency_words.txt

# 编辑操作：
# - 按 `i` 进入编辑模式
# - 修改内容
# - 按 `ESC` 退出编辑模式
# - 输入 `:wq` 保存并退出

# 或使用 nano（更简单）
nano frequency_words.txt

# 编辑操作：
# - 直接编辑
# - Ctrl+O 保存
# - Ctrl+X 退出

# 4. 重启容器
cd /soft/TrendRadar/docker
docker compose restart

# 5. 查看日志验证
docker compose logs -f trendradar
```

---

### 方法 3：使用 SCP/SFTP 上传配置

1. **在本地编辑好文件**
   - 使用 Windows 记事本或 VS Code
   - 编辑 `frequency_words.txt`

2. **上传到服务器**
   ```bash
   # 使用 SCP
   scp h:\zskj\AI\TrendRadar\TrendRadar\config\frequency_words.txt \
       user@server_ip:/soft/TrendRadar/config/

   # 或使用 SFTP 工具（如 FileZilla、WinSCP）
   ```

3. **重启容器**
   ```bash
   ssh user@server_ip
   cd /soft/TrendRadar/docker
   docker compose restart
   ```

---

## 配置验证

### 验证方法 1：查看日志

```bash
# 实时查看日志
docker compose logs -f trendradar

# 或查看最近的日志
docker compose logs --tail=50 trendradar
```

**查找关键日志**：
```
✅ 关键词匹配: "华为" -> 华为动态
✅ 关键词匹配: "AI" -> AI前沿
```

---

### 验证方法 2：手动执行测试

```bash
# 手动执行一次爬虫
docker exec -it trendradar python manage.py run
```

**查看输出**：
- 检查是否匹配到您配置的关键词
- 查看推送内容是否正确

---

### 验证方法 3：查看输出文件

```bash
# 查看 HTML 报告
ls -la h:\zskj\AI\TrendRadar\TrendRadar\output\html

# 或在容器内查看
docker exec -it trendradar ls -la /app/output/html

# 查看最新的报告
docker exec -it trendradar find /app/output/html -name "*.html" -mtime -1
```

---

### 验证方法 4：查看 Web 界面

1. 确保 Web 服务器已启动
   ```bash
   docker exec -it trendradar python manage.py webserver_status
   ```

2. 浏览器访问
   ```
   http://服务器IP:9800
   ```

3. 检查报告中的关键词统计部分

---

## 最佳实践

### ✅ 推荐做法

#### 1. 使用组别名（让推送更简洁）

```ini
# ✅ 推荐
[华为生态]
华为
鸿蒙
任正非

# ❌ 不推荐：没有别名
华为
鸿蒙
任正非
```

**效果对比**：
- 有别名：显示「华为生态」
- 无别名：显示「华为 / 鸿蒙 / 任正非」

---

#### 2. 合理过滤（避免不相关内容）

```ini
# ✅ 推荐：排除不相关内容
[苹果]
苹果
!水果  # 排除水果新闻
!果园

# ❌ 不推荐：没有过滤
[苹果]
苹果
```

---

#### 3. 控制数量（避免刷屏）

```ini
# ✅ 推荐：限制条数
[热点]
热点
@10  # 最多10条

# ❌ 不推荐：没有限制
[热点]
热点  # 可能几十条
```

---

#### 4. 使用正则（提高匹配精度）

```ini
# ✅ 推荐：精确匹配
[AI]
/\bAI\b/i  # 精确匹配AI，不匹配MAIL

# ❌ 不推荐：模糊匹配
[AI]
AI  # 会匹配 MAIL、TRAIN 等
```

---

#### 5. 分组管理（便于维护）

```ini
# ✅ 推荐：按类别分组
[科技]
AI
芯片

[体育]
NBA
足球

# ❌ 不推荐：混在一起
[新闻]
AI
NBA
芯片
足球
```

---

### ❌ 避免做法

#### 1. 关键词太多太杂

```ini
# ❌ 不好：关键词太多，难以管理
[新闻]
科技
体育
娱乐
财经
政治
教育
医疗
# ... 100多个关键词

# ✅ 好：分类管理，每组10-20个
[科技]
AI
芯片

[体育]
NBA
足球
```

---

#### 2. 忘记过滤

```ini
# ❌ 不好：匹配到大量无关内容
[苹果]
苹果

# ✅ 好：排除不相关内容
[苹果]
苹果
!水果
!果园
```

---

#### 3. 没有分组

```ini
# ❌ 不好：所有关键词混在一起，难以管理
华为
苹果
特斯拉
小米
比亚迪
# ... 更多关键词

# ✅ 好：按类别分组
[华为生态]
华为
鸿蒙

[苹果公司]
苹果
iPhone

[新能源汽车]
特斯拉
比亚迪
```

---

#### 4. 正则表达式过于复杂

```ini
# ❌ 不好：过于复杂，难以维护
/[A-Za-z0-9]{5,10}/

# ✅ 好：简单清晰
/华为|小米|比亚迪/
```

---

## 常见问题

### Q1：配置修改后多久生效？

**A**：重启容器后立即生效

```bash
cd /soft/TrendRadar/docker
docker compose restart
```

或者等待下一次定时任务执行（默认30分钟）。

---

### Q2：关键词匹配不到？

**检查清单**：

1. **关键词拼写是否正确**
   ```bash
   # 查看配置文件
   cat /soft/TrendRadar/config/frequency_words.txt
   ```

2. **是否被过滤词排除**
   ```ini
   # 检查是否有冲突的过滤词
   [苹果]
   苹果
   !水果  # 如果标题包含"水果"，会被排除
   ```

3. **查看日志是否有错误**
   ```bash
   docker compose logs trendradar | grep -i error
   ```

4. **手动执行测试**
   ```bash
   docker exec -it trendradar python manage.py run
   ```

---

### Q3：如何测试正则表达式？

**A**：使用在线工具测试

1. **在线正则表达式测试**
   - https://regex101.com/
   - https://www.regexpal.com/

2. **问 AI**
   ```
   "帮我测试正则表达式 /华为|鸿蒙/i 能否匹配以下文本：
    1. 华为发布新手机
    2. 鸿蒙系统升级
    3. 小米新品发布
   "
   ```

3. **在容器内测试**
   ```bash
   docker exec -it trendradar python -c "
   import re
   pattern = re.compile(r'华为|鸿蒙', re.IGNORECASE)
   print(pattern.search('华为发布新手机'))
   "
   ```

---

### Q4：可以匹配多个关键词吗？

**A**：可以，有两种方式

**方式1：多行（或关系）**
```ini
[华为]
华为
鸿蒙
任正非
```
效果：匹配"华为"或"鸿蒙"或"任正非"

**方式2：正则表达式**
```ini
[华为]
/华为|鸿蒙|任正非/i
```
效果：同上，但写在一行

---

### Q5：如何只匹配某个平台的新闻？

**A**：结合平台名称和关键词

```ini
[微博热搜]
微博
华为
```

或者在 `config.yaml` 中配置特定的数据源。

---

### Q6：关键词数量有限制吗？

**A**：没有硬性限制，但建议

- **每个词组**：10-20 个关键词
- **总词组数量**：不超过 20 个
- **总关键词数量**：不超过 200 个

**原因**：
- 过多关键词会影响性能
- 推送会变得冗长
- 难以维护和管理

---

### Q7：如何临时禁用某个词组？

**A**：在词组前加 `#` 注释

```ini
# [华为]  # 注释掉，暂时不启用
# 华为
# 鸿蒙
```

或者直接删除词组配置。

---

### Q8：如何导出当前配置？

**A**：查看或复制配置文件

```bash
# 查看配置
cat /soft/TrendRadar/config/frequency_words.txt

# 复制到本地
scp user@server_ip:/soft/TrendRadar/config/frequency_words.txt \
    h:\backup\frequency_words.txt

# 或在容器内查看
docker exec -it trendradar cat /app/config/frequency_words.txt
```

---

### Q9：配置文件格式错误怎么办？

**A**：检查常见错误

1. **检查空行**
   ```ini
   # ✅ 正确：词组之间有空行
   [华为]
   华为

   [苹果]
   苹果

   # ❌ 错误：词组之间没有空行
   [华为]
   华为
   [苹果]
   苹果
   ```

2. **检查括号匹配**
   ```ini
   # ✅ 正确
   [华为]
   华为

   # ❌ 错误：括号不匹配
   [华为
   华为
   ```

3. **检查特殊字符**
   ```ini
   # ✅ 正确
   /华为|鸿蒙/i

   # ❌ 错误：正则没有用斜杠包裹
   华为|鸿蒙
   ```

---

### Q10：关键词匹配是否区分大小写？

**A**：默认不区分大小写

- **普通关键词**：不区分（`AI` 和 `ai` 都能匹配）
- **正则表达式**：默认区分，加 `i` 修饰符后不区分
  ```ini
  # 不区分大小写
  /AI/i

  # 区分大小写
  /AI/
  ```

---

## 完整配置模板

```ini
# ═══════════════════════════════════════════════════════════════
#                    TrendRadar 关键词配置模板
# ═══════════════════════════════════════════════════════════════

# ───────────────────────────────────────────────────────────────
# 全局过滤区：不想看的内容
# ───────────────────────────────────────────────────────────────
[GLOBAL_FILTER]
# 过滤标题党
震惊
惊呆
不看后悔
震惊体
标题党

# 过滤广告和推广
广告
推广
引流
代购
微商

# 过滤低质内容
八卦
绯闻
撕逼

# ───────────────────────────────────────────────────────────────
# 词组定义区：想关注的关键词
# ───────────────────────────────────────────────────────────────
[WORD_GROUPS]

# ═══════════════════════════════════════════════════════════════
# 科技互联网
# ═══════════════════════════════════════════════════════════════

[AI前沿]
/AI|人工智能|机器学习|深度学习|神经网络/i
!广告

[芯片技术]
芯片
半导体
集成电路
!显卡
!广告

[华为生态]
华为
鸿蒙
任正非
海思

[苹果公司]
苹果
iPhone
iPad
Mac
!水果
!果园

[谷歌动态]
/Google|谷歌/i
/Android|安卓/i

[微软新闻]
/微软|Microsoft/i
Windows

[新能源汽车]
/特斯拉|Tesla/i
/比亚迪|BYD/i
蔚来
理想汽车
小鹏汽车

[互联网大厂]
/字节跳动|抖音/i
/腾讯|微信/i
/阿里巴巴|淘宝/i
百度

# ═══════════════════════════════════════════════════════════════
# 财经投资
# ═══════════════════════════════════════════════════════════════

[股市行情]
股票
A股
港股
美股
!广告

[基金理财]
基金
理财
投资
!诈骗
!骗局
!广告

[宏观经济]
经济
通胀
GDP
央行
降息

# ═══════════════════════════════════════════════════════════════
# 体育娱乐
# ═══════════════════════════════════════════════════════════════

[NBA]
/NBA|篮球|CBA/i

[足球]
/足球|英超|西甲|欧冠|世界杯/i

[奥运会]
奥运
冬奥会
亚运会

[娱乐圈]
明星
电影
电视剧
综艺
@10  # 限制10条

[游戏动态]
/游戏|电竞/i
/LOL|王者荣耀/i

# ═══════════════════════════════════════════════════════════════
# 地区新闻
# ═══════════════════════════════════════════════════════════════

[北京]
北京

[上海]
上海

[大湾区]
深圳
广州
香港
澳门

# ═══════════════════════════════════════════════════════════════
# 国际时事
# ═══════════════════════════════════════════════════════════════

[美国]
/美国|USA|美国/i
/特朗普|拜登/i

[欧洲]
/英国|法国|德国|欧洲/i

[日韩]
/日本|韩国/i

[国际冲突]
战争
冲突
制裁
@5  # 限制5条，避免刷屏
```

---

## 快速参考卡片

### 语法速查表

| 语法 | 含义 | 示例 |
|------|------|------|
| `关键词` | 普通匹配 | `华为` |
| `/正则/i` | 正则表达式（忽略大小写） | `/AI|人工智能/i` |
| `=> 别名` | 显示别名 | `/华为/i => 华为技术` |
| `!关键词` | 排除 | `!广告` |
| `+关键词` | 必须包含 | `+苹果` |
| `@数字` | 限制条数 | `@10` |
| `[组名]` | 词组别名 | `[华为生态]` |

### 常用正则表达式

```ini
# 匹配多个同义词
/AI|人工智能|机器学习/i

# 精确匹配单词（不匹配 MAIL 中的 AI）
/\bAI\b/i

# 匹配年份
/\d{4}年/i

# 匹配数字（亿、万）
/\d+亿/i
/\d+万/i

# 匹配手机号段
/1[3-9]\d{9}/

# 匹配版本号
/v\d+\.\d+(\.\d+)?/i
```

### 配置检查清单

配置完成后，检查以下项目：

- [ ] 词组之间有空行分隔
- [ ] 组别名用 `[ ]` 包裹
- [ ] 正则表达式用 `/ /` 包裹
- [ ] 过滤词以 `!` 开头
- [ ] 必须词以 `+` 开头
- [ ] 限制条数用 `@数字`
- [ ] 没有语法错误
- [ ] 已重启容器
- [ ] 已手动执行测试

---

## 总结

### 配置关键词的 5 个核心步骤

1. ✅ **确定关注点**：想看什么新闻？
2. ✅ **列出关键词**：有哪些相关的词？
3. ✅ **设置过滤**：不想看什么？
4. ✅ **分组管理**：如何分类？
5. ✅ **测试验证**：是否生效？

### 记住

- 🎯 **从简单开始**：先用普通关键词，再逐步使用正则
- 🎯 **使用组别名**：让推送更清晰易读
- 🎯 **合理使用过滤**：避免不相关内容
- 🎯 **控制数量**：避免推送刷屏
- 🎯 **定期维护**：根据实际效果调整配置

---

## 附录：相关文档

- [主配置文件说明](03-configuration.md)
- [Docker 部署指南](08-docker-deployment-guide.md)
- [用户手册](07-user-manual.md)

---

**配置愉快！🎉**

如有问题，请查看项目 README 或提交 Issue。
